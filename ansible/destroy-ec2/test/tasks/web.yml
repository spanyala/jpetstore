---
- name: Search ec2
  ec2_remote_facts:
    region: "{{ ec2_region }}"
    filters:
      instance-state-name: running
      "tag:Name": '{{ tag_name }}'
  register: ec2_facts

- debug: msg="{{ ec2_facts.instances }} "

- name: Terminate instances that were previously launched
  ec2:
    region: "{{ ec2_region }}"
    state: 'absent'
    instance_ids: '{{ item.id }}'
  with_items: "{{ ec2_facts.instances }}"